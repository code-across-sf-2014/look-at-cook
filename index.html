<!DOCTYPE html>
<html>
<head>
  <title>Look at SF</title>
<!--   <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">


  <link href="images/favicon.ico" rel="shortcut icon" type="image/x-icon">
 -->
  <link href="styles/master.css" rel="stylesheet" type="text/css">
  <link href="styles/print.css" media="print" rel="stylesheet" type="text/css">
  <style>
    body {
      font: 10px sans-serif;
    }

    .axis path,
    .axis line {
      fill: none;
      stroke: #000;
      shape-rendering: crispEdges;
    }

    .x.axis path {
      display: none;
    }

    .line {
      fill: none;
      stroke: steelblue;
      stroke-width: 1.5px;
    }
  </style>

  <!-- javascript libraries -->
  <script src="scripts/updated/d3.v3.min.js" defer></script>
  <script>
    // TODO(slightlyoff):
    //  - break totals out into their own chart so they don't swamp details
    //  - chart total revenue vs. total outlay
    //  - rebuild-breakdowns
    //  - fix colors!

    // Copied and modified from:
    //    http://bl.ocks.org/mbostock/3884955
    window.addEventListener("load", function(e) {
      var error = console.error.bind(console);
      var log = console.log.bind(console);
      var int = function(v) { return parseInt(v, 10); };
      var year = function(v) { return Date.parse("01 Jan, "+v+" 00:00:00"); };

      var margin = { top: 20, right: 160, bottom: 30, left: 80 },
          width = 920 - margin.left - margin.right,
          height = 400 - margin.top - margin.bottom;

      var x = d3.time.scale()
          .range([0, width]);

      var y = d3.scale.linear()
          .range([height, 0]);

      var color = d3.scale.category10();

      var xAxis = d3.svg.axis()
          .scale(x)
          .orient("bottom");

      var yAxis = d3.svg.axis()
          .scale(y)
          .orient("left");

      var line = d3.svg.line()
          .interpolate("linear")
          .x(function(d) { return x(d.year); })
          .y(function(d) { return y(d.value); });

      var svg = d3.select("#timeline-chart").append("svg")
          .attr("width", width + margin.left + margin.right)
          .attr("height", height + margin.top + margin.bottom)
        .append("g")
          .attr("transform", "translate(" + margin.left + ","
                                          + margin.top + ")");

      // Grab and graph all expeditures
      d3.csv("data/CAFR_2004_2013_expenditures.csv", function(error, data) {
        var lineItemNames = d3.keys(data[0]).filter(
          function(key) { return key !== "Year"; }
        );
        color.domain(lineItemNames);

        var items = color.domain().map(function(name) {
          return {
            name: name,
            values: data.map(function(d) {
              return { year: year(d["Year"]), value: +d[name] };
            })
          };
        });

        x.domain(d3.extent(data, function(d) { return year(d.Year); }));

        y.domain([
          d3.min(items, function(c) {
            return d3.min(c.values, function(v) { return v.value; }); }),
          d3.max(items, function(c) {
            return d3.max(c.values, function(v) { return v.value; }); })
        ]);

        svg.append("g")
            .attr("class", "x axis")
            .attr("transform", "translate(0," + height + ")")
            .call(xAxis);

        svg.append("g")
            .attr("class", "y axis")
            .call(yAxis)
          .append("text")
            .attr("transform", "rotate(-90)")
            .attr("y", 6)
            .attr("dy", ".71em")
            .style("text-anchor", "end")
            .text("Amount (thousands)");

        var items = svg.selectAll(".item")
            .data(items)
          .enter().append("g")
            .attr("class", "item");

        items.append("path")
            .attr("class", "line")
            .attr("d", function(d) { return line(d.values); })
            .style("stroke", function(d) { return color(d.name); });

        items.append("text")
            .datum(function(d) {
              return { name: d.name, value: d.values[d.values.length - 1]}; }
            )
            .attr("transform", function(d) {
              return "translate(" + x(d.value.year) + ","
                                  + y(d.value.value) + ")";
            })
            .attr("x", 3)
            .attr("dy", ".35em")
            .text(function(d) { return d.name; });
      });
    });
  </script>

  <!--
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
  <script src="scripts/updated/jquery-migrate-1.2.1.js"></script>
  <script src="scripts/highcharts.js"></script>
  <script src="scripts/jquery.dataTables.js"></script>
  <script src="scripts/dataTables.sorting.js"></script>
  <script src="scripts/jquery.formatCurrency-1.4.0.min.js"></script>
  <script src="scripts/updated/jquery.address-1.5.js"></script>
  <script src="scripts/jquery.cookie.js"></script>
  -->

  <!-- custom javascript -->
  <!--
  <script src="scripts/budget_helpers.js"></script>
  <script src="scripts/budget_queries.js"></script>
  <script src="scripts/budget_highcharts.js"></script>
  <script src="scripts/budget_lib.js"></script>
  <script src="scripts/analytics_lib.js"></script>

  <script>
  $.address.crawlable(true);
	//every action is handled by jQuery Address, which detects when the URL has changed
	$.address.externalChange(function(event) {
    BudgetLib.updateDisplay($.address.parameter('viewMode'), $.address.parameter('year'), $.address.parameter('fund'), $.address.parameter('controlOfficer'), true);
	});

	$.address.internalChange(function(event) {
    BudgetLib.updateDisplay($.address.parameter('viewMode'), $.address.parameter('year'), $.address.parameter('fund'), $.address.parameter('controlOfficer'), false);
	});

  //cookies for first time visitors
  $(function() {
    $("body").bind("click", function(e){
      $.cookie("budgetbreakdownreadme", "read", { expires: 7 });
      $("#readme").fadeOut("fast");
    });

    if ($.cookie("budgetbreakdownreadme") != "read") {
      $("#readme").fadeIn("fast");
    }
  });
  </script>
  -->
</head>
<body>

<div id="page">
  <div id="header">
    <div id="logo"><!-- FIXME(slighltyoff) --></div>
    <div id="logo-print"><!-- FIXME(slighltyoff) --></div>
    <div id="header-secondary">
      <!-- FIXME(slightlyoff) -->
<!--       <p><a href="http://www.fritchey.com"><img alt="John Fritchey" src="images/signature.png" /></a></p>
      <p id="credit">A project by <a href="http://www.derekeder.com">Derek Eder</a> and <a href="http://www.c82.net">Nick Rougeux</a> from <a href='http://opencityapps.org'>Open City</a></p>
 -->    </div>
    <div class="clear"></div>
  </div>

  <div id="content">
    <div id="content-primary">
      <span id="breadcrumbs"></span>
      <h1>Where's the money going?</h1>
      <p>Explore San Francisco's budget from 2004 to 2013 and learn how the money is being spent. <a onclick="window.scrollTo(0, document.body.scrollHeight);">Read more</a><!--  or <a href='/faq.html'>check out the FAQ</a>--> &raquo; </p>

      <div id="timeline">
        <h2></h2>
        <div id="timeline-chart"></div>
        <div id="readme"><img alt="Click points to see annual budgets below" src="images/readme.png" /></div>
      </div>

      <div id="breakdown-nav">
        <ul></ul>
        <div class="clear"></div>
      </div>

      <table id="scorecard">
        <tbody>
          <tr>
            <td id="scorecard-desc">
              <h2 id="secondary-title"></h2>
              <p></p>
            </td>
            <td>
              <h2 class="budgeted"></h2>
              <p id='budgeted-percent'></p>
            </td>
            <td>
              <h2 class="spent"></h2>
              <p id='spent-percent'></p>
            </td>
          </tr>
      </table>

      <table id="breakdown">
        <thead>
          <tr>
            <th id='breakdown-item-title'><span id="secondary-title">Fund</span></th>
            <th class="num"><span>Budgeted</span></th>
            <th class="num"><span>Spent</span></th>
            <th class="charts">Budgeted vs. spent</th>
          </tr>
        </thead>
        <tbody>
        </tbody>
      </table>

      <div id="footnotes">
        <ul>
          <li id="f-officers">* These budgets are controlled by the officers and offices listed even though not all expenses are incurred by the respective control officer.</li>
          <li id="f-zero2011"><sup class="ref">&dagger;</sup> At the end of the current fiscal year, an audit will be conducted and a report issued with the final expenditures for each department. <a href="faq.html#q3">Learn more</a></li>
        </ul>
      </div>
    </div>

    <div id="content-secondary">
      <h2>Where's the money going?</h2>
      <p>Every year the San Francisco government budgets and spends more than $X billion. The s budget impacts our lives every day. All of its funding comes from you&mdash;your sales and property taxes, your purchase fees on gas, and other goods. All of its spending exists to support you too. SF city funding drives the jail, public hospitals and clinics, the courts, and dozens of other civic institutions designed to make our region prosperous, efficient, and fair. Yet, too many residents don't understand what SF's government is or what it does. They keep asking, "Where exactly does our money go?"</p>
  	</div>

<!--     <div id="content-tertiary">
      <a id="download-button" class="action" href="https://www.google.com/fusiontables/DataSource?docid=1V4e64LrRhpnQk0LAQab6luVLrMGBGmYshogJ52M">View &amp; download data</a>
      All the data for this project is freely available to download or explore on Google Fusion Tables.
    </div>
 -->  </div>

<!--
  <div id="footer">
    <ul class="share">
      <li><a href="http://www.facebook.com/share.php?u=http%3a%2f%2flookatcook.com"><img alt="Facebook" src="images/facebook-lg.png" /> Share budget on <strong>Facebook</strong></a></li>
      <li><a href="http://twitter.com/share?text=Where's%20the%20money%20going%3F%20Explore%20Cook%20County's%20budget&amp;url=http%3a%2f%2flookatcook.com"><img alt="Twitter" src="images/twitter-lg.png" /> Share budget on <strong>Twitter</strong></a></li>
    </ul>
  </div>
 -->
</div>

</body>
</html>